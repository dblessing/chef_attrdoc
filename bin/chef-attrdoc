#!/usr/bin/env ruby

require 'optparse'

require 'chef_attrdoc'

options = {}

opt_parser = OptionParser.new do |opts|
  opts.banner = "Usage: chef_attrdoc.rb [DIR] [options]\n"
  opts.banner << "DIR - cookbook directory - defaults to the current directory\n\n"

  options[:readme] = "README.md"
  opts.on("-r", "--readme README",
    "Readme file name, defaults to README.md must be markdown") do |r|
    options[:readme] = readme
  end

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end
end.parse!

file_path = ["attributes", "default.rb"]
file_path.unshift ARGV[0] unless ARGV.empty?
file_path = File.join file_path

begin
  contents = IO.read(file_path)
rescue Exception => e
  puts e.message
  exit
end

readme = options[:readme]

attrs = ChefAttrdoc::AttributesFile.new contents
attrs.to_readme readme
